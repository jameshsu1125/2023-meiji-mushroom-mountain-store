(self.webpackChunk_2023_meiji_mushroom_mountain_store=self.webpackChunk_2023_meiji_mushroom_mountain_store||[]).push([[772],{7431:function(e,t,o){"use strict";var i=o(5861),n=o(4687),r=o.n(n),s=o(9477),a=function(){var e=(0,i.Z)(r().mark((function e(t){var o;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=new s.dpR,e.abrupt("return",new Promise((function(e,i){o.load(t,(function(t){e(t)}),i)})));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();t.Z=a},9772:function(e,t,o){"use strict";o.r(t),o.d(t,{default:function(){return ve}});var i=o(4942),n=o(885),r=o(7294),s=o(3905),a=o(5671),c=o(3144),l=o(4376),h=o(2520),u=o(1214),d=o(2982),f=o(3687),p=o(4570),m=o(9477),y=o(5444),b=o(1509);function v(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,i)}return o}var w={camera:{fov:50,far:75,type:y.CameraType.perspective},sky:{enabled:!1,turbidity:3.6,rayleigh:.165,mieCoefficient:0,mieDirectionalG:.768,inclination:.25,azimuth:.25},controls:{distance:{min:10,max:20},polar:{min:-80,max:80},azimuth:{min:-1/0,max:1/0},default:{polar:50,azimuth:35},offsetAzimuth:0,enabled:!0,panEasing:100},light:{ambient:{color:16777215,intensity:1},point:{color:16777215,intensity:1,distance:100,decay:.5,position:{x:2,y:10,z:0}},shadowMapSize:2048,debug:!0},renderer:{alpha:!0,shadowType:m._iA,exposure:.5},physics:!0,stats:!1},g={number:0,index:0,hasItem:"",drop:!1},O={startCountDown:0,maxMushroom:3,stay:0,collideGroup:{box:1,character:2,bamboo:2,mushroom:3,unset:0},cubes:(0,d.Z)(new Array(9).keys()).map((function(e){var t=function(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?v(Object(o),!0).forEach((function(t){(0,i.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):v(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}({},g);return t.number=4===e?5+Math.floor(5*Math.random()):2+Math.floor(8*Math.random()),t.index=e,t})),gameOverStayDuration:2e3},x={x:0,y:0,z:0,polar:50,azimuth:35,distance:window.innerWidth>=b.Ai.md?14:17,duration:5e3},k=o(3431),z=o.n(k),P=o(46),M=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"inCirc",o=2e4,i="inCirc"===t?P.DO.inCirc:P.DO.linear,n=z()(i[0],i[1],i[2],i[3]),r=Math.floor(n(e/o)*o/1e3);return"inCirc"===t&&e>o?e/1e3:r},j=function(e){for(var t,o=(0,d.Z)(e),i=e.length;0!==i;){t=Math.floor(Math.random()*i),i--;var n=[o[t],o[i]];o[i]=n[0],o[t]=n[1]}return o},C=o.p+"bundle/model/bamboo.glb";function D(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,i)}return o}function B(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?D(Object(o),!0).forEach((function(t){(0,i.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):D(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}var Z=function(){function e(t){var o=this,i=t.webgl,n=t.collector,r=t.onload;(0,a.Z)(this,e),this.webgl=i,this.collector=n,this.name="bamboo",this.model=null,this.body=null,this.serial=O.startCountDown+1,this.countdownSerial=0,this.enabled=!0,this.isTween=!1,this.offset={x:0,z:0},this.property={y:1+.25/.6*1,size:2,gap:.1,offset:{x:-2.1,z:-2.1},correction:{x:-.07/.6*1,y:-.22/.6*1,z:.115/.6*1}},this.getOffset=function(){o.offset.x=1.6*Math.random()-.8,o.offset.z=1.6*Math.random()-.8},this.init(),this.addBamboo().then((function(){return r(o.name)})),this.randomPosition=function(){return Math.floor(9*Math.random())}}return(0,c.Z)(e,[{key:"init",value:function(){var e=this.property,t=e.y,o=e.gap,i=e.size,n=e.offset;this.position=(0,d.Z)(new Array(9).keys()).map((function(e){var r=Math.floor(e/3),s=e%3*i+e%3*o+n.x,a=Math.floor(e/3)*i+r*o+n.z;return{x:s,y:t,z:a}})),this.tweener=new h.default}},{key:"stop",value:function(){this.enabled=!1}},{key:"hide",value:function(){this.body.position.set(10,10,10),this.model.visible=!1}},{key:"setPositionByIndex",value:function(){var e=this;if(this.enabled&&!this.isTween){var t=j(this.collector.data.filter((function(e){return!e.drop&&""===e.hasItem}))),o=(0,n.Z)(t,1)[0];if(o){var i=o.index;this.collector.setBambooIndex(i);var r=this.position[i];r.y=this.property.y-.6,this.tweener.stop().clearQueue().add({from:B(B({},r),{},{y:this.property.y-1}),to:B(B({},r),{},{y:this.property.y+.1}),duration:500,onStart:function(){e.getOffset(),e.model.visible=!0,e.isTween=!0,e.body.type=f.Body.STATIC,e.body.velocity.setZero()},onUpdate:function(t){e.body.position.copy({x:t.x+e.offset.x,y:t.y,z:t.z+e.offset.z})},onComplete:function(t){e.body.position.copy({x:t.x+e.offset.x,y:t.y,z:t.z+e.offset.z}),e.isTween=!1,e.body.type=f.Body.DYNAMIC,e.body.velocity.setZero()}}).play()}}}},{key:"addPhysics",value:function(){var e=this.webgl,t=e.world,o=e.physicsStaticMaterial,i=new f.Cylinder(.1/.6*1,.16/.6*1,.8333333333333334,16,1);this.body=new f.Body({mass:1e4,shape:i,type:f.Body.STATIC,material:o,collisionFilterGroup:O.collideGroup.bamboo,collisionFilterMask:O.collideGroup.box|O.collideGroup.character}),this.body.name=this.name,this.hide(),t.addBody(this.body)}},{key:"addBamboo",value:function(){var e=this;return new Promise((function(t,o){(0,p.Z)(C).then((function(o){var i=o.model;o.gltf.scene.traverse((function(e){e.isMesh&&(e.castShadow=!0)})),i.scale.set(1,1,1),e.webgl.scene.add(i),e.model=i,e.addPhysics(),t()})).catch(o)}))}},{key:"visible",value:function(e){this.model.visible=e}},{key:"update",value:function(e){if(this.model){var t=M(e);t>this.serial&&(this.serial=t,this.setPositionByIndex());var o=this.body.position,i=this.property.correction;this.model.position.copy({x:o.x+i.x,y:o.y+i.y,z:o.z+i.z})}}}]),e}(),S=o.p+"bundle/model/character3.glb",A=o(3295);function G(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,i)}return o}function I(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?G(Object(o),!0).forEach((function(t){(0,i.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):G(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}var E=function(){function e(t){var o=this,i=t.webgl,n=t.onMushroomTrigger,r=t.onGameOver,s=t.collector,c=t.stopRender,l=t.onload;(0,a.Z)(this,e),this.webgl=i,this.onMushroomTrigger=n,this.onGameOver=r,this.collector=s,this.stopRender=c,this.name="character",this.model=null,this.mixer=null,this.actions={},this.actionName="idle",this.delta=.03,this.speed=.08,this.isOut=!1,this.moveable=!0,this.bounce=!0,this.property={size:2,position:{x:0,y:1.38,z:0},correction:{x:0,y:-.38,z:0}},this.addCharacter().then((function(){o.actions[o.actionName].play(),l(o.name)})),this.update()}return(0,c.Z)(e,[{key:"setMoveable",value:function(e){this.moveable=e,this.stop()}},{key:"stand",value:function(){this.doActionByName("idle")}},{key:"down",value:function(){this.doActionByName("down")}},{key:"wave",value:function(){this.isOut||this.doActionByName("wave")}},{key:"walk",value:function(){this.isOut||this.doActionByName("run")}},{key:"stop",value:function(){this.model&&!this.isOut&&this.doActionByName("idle")}},{key:"rotate",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=new m._fP;t.setFromAxisAngle(new m.Pa4(0,1,0).normalize(),e),this.model.rotation.setFromQuaternion(t)}},{key:"doActionByName",value:function(e){var t=this;e!==this.actionName&&(this.actionName&&this.actions[this.actionName].stop(),this.actions[e].play(),this.actionName=e,this.actions[this.actionName]._mixer.addEventListener("finished",(function(){t.stand(),t.actions[t.actionName].loop=m.YKA})))}},{key:"addPhysics",value:function(){var e=this.webgl,t=(e.world,e.physicsImpactMaterial),o=new f.Sphere(.4);this.body=new f.Body({mass:100,shape:o,type:f.Body.DYNAMIC,material:t,collisionFilterGroup:O.collideGroup.character}),this.body.position.copy(this.property.position)}},{key:"addCharacter",value:function(){var e=this;return new Promise((function(t,o){(0,p.Z)(S).then((function(o){var i=o.model,n=o.gltf;n.scene.traverse((function(e){var t=e;t.isMesh&&(t.castShadow=!0)})),e.mixer=new m.Xcj(n.scene),n.animations.forEach((function(t){var o=t.name,i=e.mixer.clipAction(t);e.actions[o.toLowerCase()]=i})),i.scale.set(.6,.6,.6),e.webgl.scene.add(i),e.model=i,e.addPhysics(),t()})).catch(o)}))}},{key:"visible",value:function(e){this.model.visible=e}},{key:"moveByJoystick",value:function(e){var t=e.angle;return this.rotate(t-Math.PI),this.walk(),{x:12*Math.cos(t-Math.PI/2)*this.speed,z:12*Math.sin(t+Math.PI/2)*this.speed}}},{key:"moveByKeyBoard",value:function(e){var t=e.direct,o=t.ArrowLeft,i=void 0===o?0:o,n=t.ArrowRight,r=void 0===n?0:n,s=t.ArrowUp,a=void 0===s?0:s,c=t.ArrowDown,l=i-r,h=a-(void 0===c?0:c),u={"00":!1,10:-Math.PI/2,"-10":Math.PI/2,"01":Math.PI,"0-1":0,"-11":Math.PI/4*3,11:-Math.PI/4*3,"1-1":-Math.PI/4,"-1-1":Math.PI/4}["".concat(l).concat(h)];return!1!==u?(this.rotate(u),this.walk()):this.stop(),{x:l,z:h}}},{key:"move",value:function(e){var t=e.mode,o=e.direct,i=e.angle;if(t!==A.VC.unset){if(!this.isOut&&this.moveable&&(this.body||this.model)){var n=t===A.VC.keyboard?this.moveByKeyBoard({direct:o}):this.moveByJoystick({angle:i}),r=n.x,s=n.z,a=I({},this.body.position);a.x-=r*this.speed,a.z-=s*this.speed,this.body.velocity.x=0,this.body.velocity.z=0,this.body.position.x=a.x,this.body.position.z=a.z}}else this.stop()}},{key:"kickOut",value:function(){this.body.velocity.y=-10}},{key:"update",value:function(){if(this.model){var e,t=this.body.position,o=this.property.correction,i=I({},t);if(i.x+=o.x,i.y+=o.y,i.z+=o.z,this.model.position.copy(i),null===(e=this.mixer)||void 0===e||e.update(this.delta),this.isOut)return;t.y<=1.25&&(this.isOut=!0,this.down(),this.collector.stay=999,this.stopRender(),this.onGameOver())}}}]),e}(),T=function(){function e(){(0,a.Z)(this,e),this.data=(0,d.Z)(O.cubes),this.stay=4,this.bambooName="bamboo",this.mushroomName="mushroom",this.mushroomData=[]}return(0,c.Z)(e,[{key:"setBambooIndex",value:function(e){var t=this;this.data.forEach((function(e){e.hasItem===t.bambooName&&(e.hasItem="")})),this.data.forEach((function(o){o.index===e&&(o.hasItem=t.bambooName)}))}},{key:"setMushroomIndex",value:function(e){var t=this;this.data.forEach((function(e){if(t.mushroomData.length>2){var o=(0,n.Z)(t.mushroomData,1)[0];e.index===o.index&&(e.hasItem="",t.mushroomData.shift())}})),this.data.forEach((function(o){o.index===e&&(o.hasItem=t.mushroomName,t.mushroomData.push(o))}))}}]),e}(),L=function(){function e(t){var o=t.character,i=t.bamboo,n=t.mushroom,r=t.cubes,s=t.onCollide;(0,a.Z)(this,e),this.character=o,this.bamboo=i,this.mushroom=n,this.cubes=r,this.onCollide=s,this.enabled=!0,this.mode=A.VC.unset,this.direct={},this.addEvents()}return(0,c.Z)(e,[{key:"stop",value:function(){this.enabled=!1}},{key:"moveJoystick",value:function(e){this.enabled&&(this.mode=A.VC.joystick,this.angle=e.angle,this.distance=e.distance)}},{key:"stopJoystick",value:function(){this.enabled&&(this.mode=A.VC.unset,this.angle=0,this.distance=0)}},{key:"addEvents",value:function(){var e=this;window.addEventListener("keydown",(function(t){if(e.enabled){e.mode=A.VC.keyboard;var o=t.key;switch(o){case"ArrowLeft":case"ArrowUp":case"ArrowRight":case"ArrowDown":e.direct[o]=1}}})),window.addEventListener("keyup",(function(t){if(e.enabled){var o=t.key;switch(o){case"ArrowLeft":case"ArrowUp":case"ArrowRight":case"ArrowDown":e.direct[o]=0}}}))}}]),e}(),N=o(5861),F=o(4687),R=o.n(F),_=o(7431),U=o.p+"bundle/image/pages/free/game/texture/cube-top-2.jpg",V=o.p+"bundle/image/pages/free/game/texture/cube-side.jpg",Y=function(){function e(t){var o=t.webgl,i=t.collector,n=t.onGameCountDown,r=t.onGameOver,s=t.stopRender,c=t.onload;(0,a.Z)(this,e),this.webgl=o,this.collector=i,this.onGameCountDown=n,this.onGameOver=r,this.stopRender=s,this.onload=c,this.name="box",this.serial=O.startCountDown+1,this.countdownSerial=!1,this.enabled=!0,this.boxes=[],this.bodies=[],this.numberOfBox=i.data.length,this.size=2,this.gapSize=.1,this.addBoxes()}var t;return(0,c.Z)(e,[{key:"addPhysics",value:function(e){var t=e.col,o=e.row,i=e.i,n=this.webgl,r=n.world,s=n.physicsStaticMaterial,a=new f.Vec3(1,1,1),c=new f.Box(a),l=new f.Body({mass:0,shape:c,type:f.Body.STATIC,material:s,collisionFilterGroup:O.collideGroup.box,collisionFilterMask:O.collideGroup.bamboo|O.collideGroup.mushroom|O.collideGroup.character}),h=1*(this.size+this.gapSize),u=1*(this.size+this.gapSize),d=i%3*this.size+o*this.gapSize-h,p=Math.floor(i/3)*this.size+t*this.gapSize-u;l.position.set(d,0,p),l.name=this.name+i,r.addBody(l),this.bodies.push(l)}},{key:"addBoxes",value:(t=(0,N.Z)(R().mark((function e(){var t,o,i,n,r,s,a,c=this;return R().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,_.Z)(U);case 2:return t=e.sent,e.next=5,(0,_.Z)(V);case 5:o=e.sent,t.wrapS=m.rpg,t.wrapT=m.rpg,t.repeat.set(1,.1),i=this.webgl.scene,n=new m.ZAu,r=new m.DvJ(this.size,this.size,this.size),s=new m.YBo({color:1641989}),a=new m.Wid({map:o}),this.boxes=(0,d.Z)(new Array(this.numberOfBox).keys()).map((function(e){var o=new m.xoR({map:t.clone()});o.map.offset.set(0,.1*(c.numberOfBox-c.collector.data[e].number));var i=new m.Kj0(r,[a,a,o,s,a,a]),l=Math.floor(e/3),h=e%3,u=e%3*c.size+h*c.gapSize,d=Math.floor(e/3)*c.size+l*c.gapSize;return i.receiveShadow=!0,i.position.set(u,0,d),n.add(i),c.addPhysics({col:l,row:h,i:e}),i})),n.position.x=0-1*(this.size+this.gapSize),n.position.z=0-1*(this.size+this.gapSize),i.add(n),this.onload(this.name);case 19:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"visible",value:function(e){this.boxes.forEach((function(t){t.visible=e}))}},{key:"stop",value:function(){this.enabled=!1}},{key:"out",value:function(){this.onGameOver(),this.stopRender()}},{key:"updateMaterial",value:function(){var e=this;this.boxes.forEach((function(t,o){var i=t.material[2].map,n=e.collector.data[o].number,r=Math.round(e.numberOfBox-n);i.offset.setY(r/10),r===e.numberOfBox&&(e.collector.data[o].number=10,i.offset.setY(1))}))}},{key:"setMaterialByIndex",value:function(){this.collector.data.forEach((function(e){var t=e.number-1;e.number=t<0?0:t})),this.updateMaterial()}},{key:"update",value:function(e){var t=this;if(this.bodies.length===this.numberOfBox){var o=M(e,"linear");o>this.serial&&(this.serial=o,this.enabled&&this.setMaterialByIndex()),o!==this.countdownSerial&&this.countdownSerial<O.startCountDown+1&&(this.countdownSerial=o,this.onGameCountDown(O.startCountDown-o)),(0,d.Z)(new Array(this.numberOfBox).keys()).forEach((function(e){var o=t.bodies[e],i=t.boxes[e],n=o.position,r=-t.size-t.gapSize,s=-t.size-t.gapSize;i.position.copy({x:n.x-r,y:n.y-0,z:n.z-s})}))}}}]),e}(),W=o.p+"bundle/model/mushroom.glb";function J(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,i)}return o}function Q(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?J(Object(o),!0).forEach((function(t){(0,i.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):J(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}var H=function(){function e(t){var o=this,i=t.webgl,n=t.collector,r=t.onload;(0,a.Z)(this,e),this.webgl=i,this.collector=n,this.name="mushroom",this.models=[],this.bodies=[],this.serial=O.startCountDown+1,this.enabled=!0,this.offset={x:0,z:0},this.getOffset=function(){o.offset.x=1.6*Math.random()-.8,o.offset.z=1.6*Math.random()-.8},this.property={index:5,y:1.15,size:2,gap:.1,offset:{x:-2.1,z:-2.1},correction:{x:-.08/.6*1,y:-.15,z:.095/.6*1}},this.init(),this.addMushroom().then((function(){return r(o.name)})),this.randomPosition=function(){return Math.floor(9*Math.random())}}return(0,c.Z)(e,[{key:"stop",value:function(){this.enabled=!1}},{key:"init",value:function(){var e=this.property,t=e.y,o=e.size,i=e.gap,n=e.offset;this.position=(0,d.Z)(new Array(9).keys()).map((function(e){var r=Math.floor(e/3),s=e%3*o+e%3*i+n.x,a=Math.floor(e/3)*o+r*i+n.z;return{x:s,y:t,z:a}})),this.tweeners=(0,d.Z)(new Array(O.maxMushroom).keys()).map((function(){return new h.default}))}},{key:"setPositionByIndex",value:function(){var e=this;if(this.enabled){var t=j(this.collector.data.filter((function(t,o){return!t.drop&&e.collector.stay!==o&&""===t.hasItem}))),o=(0,n.Z)(t,1)[0];if(o){var i=o.index;this.collector.setMushroomIndex(i);var r=this.position[i];r.y=this.property.y-.6;var s=this.serial%O.maxMushroom,a=this.tweeners[s],c=this.bodies[s],l=this.models[s];a&&a.stop().clearQueue().add({from:Q(Q({},r),{},{y:this.property.y-1}),to:Q(Q({},r),{},{y:this.property.y}),duration:200,onStart:function(){e.getOffset(),l.visible=!0,c.type=f.Body.STATIC,c.collisionFilterMask=O.collideGroup.unset,c.velocity.setZero()},onUpdate:function(t){c.position.copy({x:t.x+e.offset.x,y:t.y,z:t.z+e.offset.z})},onComplete:function(t){c.position.copy({x:t.x+e.offset.x,y:t.y,z:t.z+e.offset.z}),c.type=f.Body.DYNAMIC,c.velocity.setZero(),c.quaternion.setFromAxisAngle(new f.Vec3(1,0,0),0),c.collisionFilterMask=O.collideGroup.box|O.collideGroup.character}}).play()}}}},{key:"addPhysics",value:function(){var e=this,t=this.webgl,o=t.world,i=t.physicsStaticMaterial,n=new f.Cylinder(.16/.6*1,.16/.6*1,.33333333333333337,16,1);this.bodies=(0,d.Z)(new Array(O.maxMushroom).keys()).map((function(){var t=new f.Body({mass:100,shape:n,type:f.Body.STATIC,material:i,collisionFilterGroup:O.collideGroup.mushroom,collisionFilterMask:O.collideGroup.box|O.collideGroup.character});return t.name=e.name,o.addBody(t),t}))}},{key:"addMushroom",value:function(){var e=this;return new Promise((function(t,o){(0,p.Z)(W).then((function(o){var i=o.model;o.gltf.scene.traverse((function(e){var t=e;t.isMesh&&(t.castShadow=!0)})),i.scale.set(1,1,1),e.models=(0,d.Z)(new Array(O.maxMushroom).keys()).map((function(){var t=i.clone();return e.webgl.scene.add(t),t})),e.addPhysics(),t()})).catch(o)}))}},{key:"visible",value:function(e){this.models.forEach((function(t){t.visible=e}))}},{key:"update",value:function(e){var t=this;if(0!==this.models.length){var o=M(e,"linear");o>this.serial&&(this.serial=o,this.setPositionByIndex()),(0,d.Z)(new Array(O.maxMushroom).keys()).forEach((function(e){var o=t.models[e],i=t.bodies[e].position,n=t.property.correction;o.position.copy({x:i.x+n.x,y:i.y+n.y,z:i.z+n.z})}))}}}]),e}();function K(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,i)}return o}function X(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?K(Object(o),!0).forEach((function(t){(0,i.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):K(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}var q=function(){function e(t){var o=this,i=t.onMushroomTrigger,n=t.onModulesLoaded,r=t.onGameCountDown,s=t.onGameOver,c=t.onCameraZoomOuted;(0,a.Z)(this,e),this.webgl=new u.Z(w),this.webgl.controls.controls.enablePan=!1,this.onMushroomTrigger=i,this.onModulesLoaded=n,this.onGameOver=s,this.onCameraZoomOuted=c,this.onGameCountDown=r,this.collector=new T,this.cubes=null,this.character=null,this.mushroom=null,this.bamboo=null,this.controller=null,this.lookTarget={x:0,y:0,z:0},this.webgl.controls.lookAt(this.lookTarget),this.loaderData={},this.onGLBLoaded=function(e){o.loaderData[e]=!0,Object.keys(o.loaderData).length>=4&&n()},this.gameStart=!1,this.firstDelta=!1,this.addMushroom(),this.addBamboo(),this.addCubes(s),this.addCharacter(i,s),this.addGUI(),window.addEventListener("resize",(function(){var e=o.webgl,t=e.camera,i=e.renderer;t.aspect=window.innerWidth/window.innerHeight,t.updateProjectionMatrix(),i.renderer.setSize(window.innerWidth,window.innerHeight)}),!1)}return(0,c.Z)(e,[{key:"addGUI",value:function(){var e=this,t=new l.XS,o=t.addFolder("全域光(無陰影)"),i=this.webgl.scene.children[0].color;i.intensity=w.light.ambient.intensity,o.add(i,"r",0,1,.1),o.add(i,"g",0,1,.1),o.add(i,"b",0,1,.1),o.add(i,"intensity",.1,5,.1).onChange((function(t){e.webgl.scene.children[0].intensity=t}));var n=t.addFolder("太陽光(有陰影)"),r=this.webgl.scene.children[1],s=r.color,a=r.position;s.intensity=w.light.point.intensity,n.add(s,"r",0,1,.1),n.add(s,"g",0,1,.1),n.add(s,"b",0,1,.1),n.add(s,"intensity",.1,5,.1).onChange((function(t){e.webgl.scene.children[1].intensity=t})),n.add(a,"x",-10,10,.1),n.add(a,"y",0,10,.1),n.add(a,"z",-10,10,.1);var c=this.webgl.render;o.add(c,"toneMappingExposure",0,2,.1)}},{key:"start",value:function(e){e.appendChild(this.webgl.render.domElement),this.update(),this.character.wave(),this.begin()}},{key:"zoomOut",value:function(){var e=this,t=X(X({},this.webgl.controls.get()),this.lookTarget),o=X({},x);delete o.duration;var i=function(t){e.webgl.controls.set(t),e.webgl.controls.lookAt(t)};new h.default({from:t,to:o,easing:h.Bezier.easeInOutQuart,duration:x.duration,onUpdate:i,onComplete:function(t){i(t),e.onCameraZoomOuted()}}).play()}},{key:"begin",value:function(){this.addController(),this.gameStart=!0}},{key:"addController",value:function(){var e=this.webgl,t=this.cubes,o=this.character,i=this.mushroom,n=this.bamboo;this.controller=new L({webgl:e,cubes:t,character:o,mushroom:i,bamboo:n})}},{key:"addBamboo",value:function(){this.bamboo=new Z({webgl:this.webgl,collector:this.collector,onload:this.onGLBLoaded})}},{key:"addMushroom",value:function(){this.mushroom=new H({webgl:this.webgl,collector:this.collector,onload:this.onGLBLoaded})}},{key:"addCharacter",value:function(e,t){var o=this;this.character=new E({webgl:this.webgl,onMushroomTrigger:e,onGameOver:t,collector:this.collector,stopRender:function(){var e;null===(e=o.controller)||void 0===e||e.stop(),o.bamboo.stop(),o.mushroom.stop(),o.cubes.stop()},onload:this.onGLBLoaded})}},{key:"addCubes",value:function(e){var t=this;this.cubes=new Y({webgl:this.webgl,onGameOver:e,collector:this.collector,onGameCountDown:this.onGameCountDown,stopRender:function(){var e;null===(e=t.controller)||void 0===e||e.stop(),t.bamboo.stop(),t.mushroom.stop(),t.cubes.stop(),t.character.kickOut()},onload:this.onGLBLoaded})}},{key:"update",value:function(){var e=this,t=this.webgl.enterframe;t.add((function(t){var o=t.delta;if(e.gameStart){var i,n,r;!1===e.firstDelta&&(e.firstDelta=o);var s=o-e.firstDelta;null===(i=e.bamboo)||void 0===i||i.update(s),null===(n=e.mushroom)||void 0===n||n.update(s),null===(r=e.cubes)||void 0===r||r.update(s)}e.controller&&e.character.move(e.controller),e.character.update()})),t.play()}}]),e}(),$=o(3379),ee=o.n($),te=o(7795),oe=o.n(te),ie=o(569),ne=o.n(ie),re=o(3565),se=o.n(re),ae=o(9216),ce=o.n(ae),le=o(4589),he=o.n(le),ue=o(2351),de=o.n(ue),fe={};fe.styleTagTransform=he(),fe.setAttributes=se(),fe.insert=ne().bind(null,"head"),fe.domAPI=oe(),fe.insertStyleElement=ce(),ee()(de(),fe),de()&&de().locals&&de().locals;var pe,me=o(5893);function ye(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,i)}return o}function be(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?ye(Object(o),!0).forEach((function(t){(0,i.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):ye(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}var ve=(0,r.memo)((function(){var e=(0,r.useRef)(),t=(0,r.useRef)(),o=(0,r.useContext)(s.GL),i=(0,n.Z)(o,2),a=i[0],c=i[1],l=a.page,h=(0,r.useCallback)((function(){c((function(e){return be(be({},e),{},{steps:s._H.modelLoaded})})),l===s.iQ.game&&t.current.start(e.current)}),[]),u=(0,r.useCallback)((function(){c((function(e){return be(be({},e),{},{score:e.score+1})}))}),[]),d=(0,r.useCallback)((function(){c((function(e){return be(be({},e),{},{over:!0})}))}),[]),f=(0,r.useCallback)((function(){t.current.begin(),c((function(e){return be(be({},e),{},{steps:s._H.didFadeIn})}))}),[]),p=(0,r.useCallback)((function(e){c((function(t){return be(be({},t),{},{countdown:e})}))}),[]);return(0,r.useEffect)((function(){return pe?(t.current=pe,t.current.start(e.current)):(pe=new q({onMushroomTrigger:u,onModulesLoaded:h,onGameOver:d,onCameraZoomOuted:f,onGameCountDown:p}),t.current=pe),function(){var e;return null===(e=t.current.webgl)||void 0===e?void 0:e.enterframe.stop()}}),[]),(0,me.jsx)("div",{className:"WebGL",children:(0,me.jsx)("div",{ref:e,className:"h-full w-full"})})}))},2351:function(e,t,o){var i=o(8081),n=o(3645)(i);n.push([e.id,".WebGL {\n    position: relative;\n    height: 100vh;\n    width: 100%;\n    overflow: hidden\n}\n",""]),e.exports=n}}]);