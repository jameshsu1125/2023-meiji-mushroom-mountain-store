(self.webpackChunk_2023_meiji_mushroom_mountain_store=self.webpackChunk_2023_meiji_mushroom_mountain_store||[]).push([[517],{6517:function(e,t,o){"use strict";o.r(t),o.d(t,{default:function(){return W}});var n=o(885),i=o(7294),r=o(5671),s=o(3144),a=o(4376),c=o(1214),l=o(4942),u=o(2982),h=o(3687),d=o(4570),f=o(2520),y=o(9477);function p(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}var m={camera:{fov:50,far:75,type:o(5444).CameraType.perspective},sky:{enabled:!0,turbidity:3.6,rayleigh:.165,mieCoefficient:0,mieDirectionalG:.768,inclination:.25,azimuth:.25},controls:{distance:{min:13,max:13},polar:{min:50,max:50},azimuth:{min:35,max:35},default:{polar:50,azimuth:35},offsetAzimuth:0,enabled:!0,panEasing:100},light:{ambient:{color:13163508,intensity:1},point:{color:16042184,intensity:.9,distance:100,decay:.5,position:{x:0,y:8,z:0}},shadowMapSize:1024,debug:!0},renderer:{alpha:!1,shadowType:y.ntZ,exposure:1,outputEncoding:y.knz,physicallyCorrectLights:!1},physics:!0,stats:!0},b={number:0,index:0,hasItem:"",drop:!1},v={startCountDown:3,maxMushroom:3,stay:0,cubes:(0,u.Z)(new Array(9).keys()).map((function(e){var t=function(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?p(Object(o),!0).forEach((function(t){(0,l.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):p(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}({},b);return t.number=2+Math.floor(8*Math.random()),t.index=e,t})),collideGroup:{box:1,character:2,bamboo:2,mushroom:3,unset:0}},w=o(3377),g=o.p+"bundle/model/bamboo.glb";function x(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function k(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?x(Object(o),!0).forEach((function(t){(0,l.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):x(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}var O=function(){function e(t){var o=this,n=t.webgl,i=t.collector,s=t.onload;(0,r.Z)(this,e),this.webgl=n,this.collector=i,this.name="bamboo",this.model=null,this.body=null,this.serial=v.startCountDown,this.countdownSerial=0,this.enabled=!0,this.isTween=!1,this.offset={x:0,z:0},this.property={y:1+.25/.6*1,size:2,gap:.1,offset:{x:-2.1,z:-2.1},correction:{x:-.07/.6*1,y:-.25/.6*1,z:.115/.6*1}},this.getOffset=function(){o.offset.x=1.6*Math.random()-.8,o.offset.z=1.6*Math.random()-.8},this.init(),this.addBamboo().then((function(){return s(o.name)})),this.randomPosition=function(){return Math.floor(9*Math.random())}}return(0,s.Z)(e,[{key:"init",value:function(){var e=this.property,t=e.y,o=e.gap,n=e.size,i=e.offset;this.position=(0,u.Z)(new Array(9).keys()).map((function(e){var r=Math.floor(e/3),s=e%3*n+e%3*o+i.x,a=Math.floor(e/3)*n+r*o+i.z;return{x:s,y:t,z:a}})),this.tweener=new f.default}},{key:"stop",value:function(){this.enabled=!1}},{key:"hide",value:function(){this.body.position.set(10,10,10),this.model.visible=!1}},{key:"setPositionByIndex",value:function(){var e=this;if(this.enabled&&!this.isTween){var t=(0,w.Sy)(this.collector.data.filter((function(e){return!e.drop&&""===e.hasItem}))),o=(0,n.Z)(t,1)[0];if(o){var i=o.index;this.collector.setBambooIndex(i);var r=this.position[i];r.y=this.property.y-.6,this.tweener.stop().clearQueue().add({from:k(k({},r),{},{y:this.property.y-1}),to:k(k({},r),{},{y:this.property.y+.1}),duration:500,onStart:function(){e.getOffset(),e.model.visible=!0,e.isTween=!0,e.body.type=h.Body.STATIC,e.body.velocity.setZero()},onUpdate:function(t){e.body.position.copy({x:t.x+e.offset.x,y:t.y,z:t.z+e.offset.z})},onComplete:function(t){e.body.position.copy({x:t.x+e.offset.x,y:t.y,z:t.z+e.offset.z}),e.isTween=!1,e.body.type=h.Body.DYNAMIC,e.body.velocity.setZero()}}).play()}}}},{key:"addPhysics",value:function(){var e=this.webgl,t=e.world,o=e.physicsStaticMaterial,n=new h.Cylinder(.1/.6*1,.16/.6*1,.8333333333333334,16,1);this.body=new h.Body({mass:1e4,shape:n,type:h.Body.STATIC,material:o,collisionFilterGroup:v.collideGroup.bamboo,collisionFilterMask:v.collideGroup.box|v.collideGroup.character}),this.body.name=this.name,this.hide(),t.addBody(this.body)}},{key:"addBamboo",value:function(){var e=this;return new Promise((function(t,o){(0,d.Z)(g).then((function(o){var n=o.model;o.gltf.scene.traverse((function(e){e.isMesh&&(e.castShadow=!0)})),n.scale.set(1,1,1),e.webgl.scene.add(n),e.model=n,e.addPhysics(),t()})).catch(o)}))}},{key:"visible",value:function(e){this.model.visible=e}},{key:"update",value:function(e){if(this.model){var t=(0,w.f0)(e);t>this.serial&&(this.serial=t,this.setPositionByIndex());var o=this.body.position,n=this.property.correction;this.model.position.copy({x:o.x+n.x,y:o.y+n.y,z:o.z+n.z})}}}]),e}(),M=o.p+"bundle/model/character.glb";function z(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function P(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?z(Object(o),!0).forEach((function(t){(0,l.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):z(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}var C=function(){function e(t){var o=this,n=t.webgl,i=t.onMushroomTrigger,s=t.onGameOver,a=t.collector,c=t.stopRender,l=t.onload;(0,r.Z)(this,e),this.webgl=n,this.onMushroomTrigger=i,this.onGameOver=s,this.collector=a,this.stopRender=c,this.name="character",this.model=null,this.mixer=null,this.actions={},this.actionName="idle",this.delta=.03,this.speed=.08,this.isOut=!1,this.moveable=!0,this.bounce=!0,this.property={size:2,position:{x:0,y:1.6,z:0},correction:{x:0,y:-.38,z:0}},this.addCharacter().then((function(){o.actions[o.actionName].play(),l(o.name)})),this.update()}return(0,s.Z)(e,[{key:"setMoveable",value:function(e){this.moveable=e,this.stop()}},{key:"down",value:function(){this.doActionByName("down")}},{key:"wave",value:function(){this.isOut||this.doActionByName("wavehand")}},{key:"walk",value:function(){this.isOut||this.doActionByName("run")}},{key:"stop",value:function(){this.model&&!this.isOut&&this.doActionByName("idle")}},{key:"rotate",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=new y._fP;t.setFromAxisAngle(new y.Pa4(0,1,0).normalize(),e),this.model.rotation.setFromQuaternion(t)}},{key:"doActionByName",value:function(e){e!==this.actionName&&(this.actionName&&this.actions[this.actionName].stop(),this.actions[e].play(),this.actionName=e)}},{key:"addPhysics",value:function(){var e=this,t=this.webgl,o=t.world,n=t.physicsImpactMaterial,i=new h.Sphere(.4);this.body=new h.Body({mass:100,shape:i,type:h.Body.DYNAMIC,material:n,collisionFilterGroup:v.collideGroup.character}),this.body.position.copy(this.property.position),this.body.addEventListener("collide",(function(t){var o=t.body.name,n=t.target;if(o.indexOf("box")>=0){n.velocity.setZero();var i=Number(o.slice(3));return e.collector.stay=i,void(e.moveable||(e.moveable=!0))}if("bamboo"===o){var r=t.body.position,s=n.position,a={x:2*(r.x-s.x>0?1:-1)*-3,z:2*(r.z-s.z>0?1:-1)*-3,y:8};n.velocity.setZero(),e.setMoveable(!1),requestAnimationFrame((function(){n.velocity.set(a.x,a.y,a.z)}))}else{var c=t.body;if(c.type=h.Body.STATIC,c.velocity.setZero(),c.position.y=-1,setTimeout((function(){c.position.y=-1e3}),50),!e.bounce)return;e.bounce=!1,e.onMushroomTrigger(),setTimeout((function(){e.bounce=!0}),500)}})),o.addBody(this.body)}},{key:"addCharacter",value:function(){var e=this;return new Promise((function(t,o){(0,d.Z)(M).then((function(o){var n=o.model,i=o.gltf;i.scene.traverse((function(e){var t=e;t.isMesh&&(t.castShadow=!0)})),e.mixer=new y.Xcj(i.scene),i.animations.forEach((function(t){var o=t.name,n=e.mixer.clipAction(t);e.actions[o.toLowerCase()]=n})),n.scale.set(.6,.6,.6),e.webgl.scene.add(n),e.model=n,e.addPhysics(),t()})).catch(o)}))}},{key:"visible",value:function(e){this.model.visible=e}},{key:"moveByJoystick",value:function(e){var t=e.angle;return this.rotate(t-Math.PI),this.walk(),{x:12*Math.cos(t-Math.PI/2)*this.speed,z:12*Math.sin(t+Math.PI/2)*this.speed}}},{key:"moveByKeyBoard",value:function(e){var t=e.direct,o=t.ArrowLeft,n=void 0===o?0:o,i=t.ArrowRight,r=void 0===i?0:i,s=t.ArrowUp,a=void 0===s?0:s,c=t.ArrowDown,l=n-r,u=a-(void 0===c?0:c),h={"00":!1,10:-Math.PI/2,"-10":Math.PI/2,"01":Math.PI,"0-1":0,"-11":Math.PI/4*3,11:-Math.PI/4*3,"1-1":-Math.PI/4,"-1-1":Math.PI/4}["".concat(l).concat(u)];return!1!==h?(this.rotate(h),this.walk()):this.stop(),{x:l,z:u}}},{key:"move",value:function(e){var t=e.mode,o=e.direct,n=e.angle;if(0!==t){if(!this.isOut&&this.moveable&&(this.body||this.model)){var i=1===t?this.moveByKeyBoard({direct:o}):this.moveByJoystick({angle:n}),r=i.x,s=i.z,a=P({},this.body.position);a.x-=r*this.speed,a.z-=s*this.speed,this.body.velocity.x=0,this.body.velocity.z=0,this.body.position.x=a.x,this.body.position.z=a.z}}else this.stop()}},{key:"kickOut",value:function(){this.body.velocity.y=-10}},{key:"update",value:function(){if(this.model){var e,t=this.body.position,o=this.property.correction,n=P({},t);if(n.x+=o.x,n.y+=o.y,n.z+=o.z,this.model.position.copy(n),null===(e=this.mixer)||void 0===e||e.update(this.delta),this.isOut)return;t.y<=1.25&&(this.isOut=!0,this.down(),this.collector.stay=999,this.stopRender(),this.onGameOver())}}}]),e}(),j=function(){function e(){(0,r.Z)(this,e),this.data=(0,u.Z)(v.cubes),this.stay=4,this.bambooName="bamboo",this.mushroomName="mushroom",this.mushroomData=[]}return(0,s.Z)(e,[{key:"setBambooIndex",value:function(e){var t=this;this.data.forEach((function(e){e.hasItem===t.bambooName&&(e.hasItem="")})),this.data.forEach((function(o){o.index===e&&(o.hasItem=t.bambooName)}))}},{key:"setMushroomIndex",value:function(e){var t=this;this.data.forEach((function(e){if(t.mushroomData.length>2){var o=(0,n.Z)(t.mushroomData,1)[0];e.index===o.index&&(e.hasItem="",t.mushroomData.shift())}})),this.data.forEach((function(o){o.index===e&&(o.hasItem=t.mushroomName,t.mushroomData.push(o))}))}}]),e}(),D=function(){function e(t){var o=t.character,n=t.bamboo,i=t.mushroom,s=t.cubes,a=t.onCollide;(0,r.Z)(this,e),this.character=o,this.bamboo=n,this.mushroom=i,this.cubes=s,this.onCollide=a,this.enabled=!0,this.mode=0,this.direct={},this.addEvents()}return(0,s.Z)(e,[{key:"stop",value:function(){this.enabled=!1}},{key:"moveJoystick",value:function(e){this.enabled&&(this.mode=2,this.angle=e.angle,this.distance=e.distance)}},{key:"stopJoystick",value:function(){this.enabled&&(this.mode=0,this.angle=0,this.distance=0)}},{key:"addEvents",value:function(){var e=this;window.addEventListener("keydown",(function(t){if(e.enabled){e.mode=1;var o=t.key;switch(o){case"ArrowLeft":case"ArrowUp":case"ArrowRight":case"ArrowDown":e.direct[o]=1}}})),window.addEventListener("keyup",(function(t){if(e.enabled){var o=t.key;switch(o){case"ArrowLeft":case"ArrowUp":case"ArrowRight":case"ArrowDown":e.direct[o]=0}}}))}}]),e}(),S=o(5861),B=o(4687),G=o.n(B),Z=function(){var e=(0,S.Z)(G().mark((function e(t){var o;return G().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=new y.dpR,e.abrupt("return",new Promise((function(e,n){o.load(t,(function(t){e(t)}),n)})));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),A=Z,I=o.p+"bundle/image/pages/game/webgl/texture/cube-top.jpg",E=o.p+"bundle/image/pages/game/webgl/texture/cube-side.jpg",T=function(){function e(t){var o=t.webgl,n=t.collector,i=t.onGameCountDown,s=t.onGameOver,a=t.stopRender,c=t.onload;(0,r.Z)(this,e),this.webgl=o,this.collector=n,this.onGameCountDown=i,this.onGameOver=s,this.stopRender=a,this.onload=c,this.name="box",this.serial=v.startCountDown,this.countdownSerial=0,this.enabled=!0,this.boxes=[],this.bodies=[],this.numberOfBox=n.data.length,this.size=2,this.gapSize=.1,this.addBoxes()}var t;return(0,s.Z)(e,[{key:"addPhysics",value:function(e){var t=e.col,o=e.row,n=e.i,i=this.webgl,r=i.world,s=i.physicsStaticMaterial,a=new h.Vec3(1,1,1),c=new h.Box(a),l=new h.Body({mass:0,shape:c,type:h.Body.STATIC,material:s,collisionFilterGroup:v.collideGroup.box,collisionFilterMask:v.collideGroup.bamboo|v.collideGroup.mushroom|v.collideGroup.character}),u=1*(this.size+this.gapSize),d=1*(this.size+this.gapSize),f=n%3*this.size+o*this.gapSize-u,y=Math.floor(n/3)*this.size+t*this.gapSize-d;l.position.set(f,0,y),l.name=this.name+n,r.addBody(l),this.bodies.push(l)}},{key:"addBoxes",value:(t=(0,S.Z)(G().mark((function e(){var t,o,n,i,r,s,a,c=this;return G().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,A(I);case 2:return t=e.sent,e.next=5,A(E);case 5:o=e.sent,t.wrapS=y.rpg,t.wrapT=y.rpg,t.repeat.set(1,.1),n=this.webgl.scene,i=new y.ZAu,r=new y.DvJ(this.size,this.size,this.size),s=new y.YBo({color:1641989}),a=new y.Wid({map:o}),this.boxes=(0,u.Z)(new Array(this.numberOfBox).keys()).map((function(e){var o=new y.Wid({map:t.clone()});o.map.offset.set(0,.1*(c.numberOfBox-c.collector.data[e].number));var n=new y.Kj0(r,[a,a,o,s,a,a]),l=Math.floor(e/3),u=e%3,h=e%3*c.size+u*c.gapSize,d=Math.floor(e/3)*c.size+l*c.gapSize;return n.receiveShadow=!0,n.position.set(h,0,d),i.add(n),c.addPhysics({col:l,row:u,i:e}),n})),i.position.x=0-1*(this.size+this.gapSize),i.position.z=0-1*(this.size+this.gapSize),n.add(i),this.onload(this.name);case 19:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"visible",value:function(e){this.boxes.forEach((function(t){t.visible=e}))}},{key:"stop",value:function(){this.enabled=!1}},{key:"out",value:function(){this.onGameOver(),this.stopRender()}},{key:"updateMaterial",value:function(){var e=this;this.boxes.forEach((function(t,o){var n=t.material[2].map,i=e.collector.data[o].number,r=Math.round(e.numberOfBox-i);if(n.offset.setY(r/10),r===e.numberOfBox)if(e.collector.stay===o){e.collector.data[o].drop=!0;var s=e.bodies[o];s.mass=1e4,s.updateMassProperties(),s.type=h.Body.DYNAMIC,s.velocity.set(0,-10,0),e.out()}else e.collector.data[o].number=10,n.offset.setY(1)}))}},{key:"setMaterialByIndex",value:function(){this.collector.data.forEach((function(e){var t=e.number-1;e.number=t<0?0:t})),this.updateMaterial()}},{key:"update",value:function(e){var t=this;if(this.bodies.length===this.numberOfBox){var o=(0,w.f0)(e,"linear");o>this.serial&&(this.serial=o,this.enabled&&this.setMaterialByIndex()),o!==this.countdownSerial&&this.countdownSerial<v.startCountDown&&(this.countdownSerial=o,this.onGameCountDown(v.startCountDown-o+1)),(0,u.Z)(new Array(this.numberOfBox).keys()).forEach((function(e){var o=t.bodies[e],n=t.boxes[e],i=o.position,r=-t.size-t.gapSize,s=-t.size-t.gapSize;n.position.copy({x:i.x-r,y:i.y-0,z:i.z-s})}))}}}]),e}(),N=o.p+"bundle/model/mushroom.glb";function L(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function R(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?L(Object(o),!0).forEach((function(t){(0,l.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):L(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}var J=function(){function e(t){var o=this,n=t.webgl,i=t.collector,s=t.onload;(0,r.Z)(this,e),this.webgl=n,this.collector=i,this.name="mushroom",this.models=[],this.bodies=[],this.serial=v.startCountDown,this.enabled=!0,this.offset={x:0,z:0},this.getOffset=function(){o.offset.x=1.6*Math.random()-.8,o.offset.z=1.6*Math.random()-.8},this.property={index:5,y:1.15,size:2,gap:.1,offset:{x:-2.1,z:-2.1},correction:{x:-.08/.6*1,y:-.15,z:.095/.6*1}},this.init(),this.addMushroom().then((function(){return s(o.name)})),this.randomPosition=function(){return Math.floor(9*Math.random())}}return(0,s.Z)(e,[{key:"stop",value:function(){this.enabled=!1}},{key:"init",value:function(){var e=this.property,t=e.y,o=e.size,n=e.gap,i=e.offset;this.position=(0,u.Z)(new Array(9).keys()).map((function(e){var r=Math.floor(e/3),s=e%3*o+e%3*n+i.x,a=Math.floor(e/3)*o+r*n+i.z;return{x:s,y:t,z:a}})),this.tweeners=(0,u.Z)(new Array(v.maxMushroom).keys()).map((function(){return new f.default}))}},{key:"setPositionByIndex",value:function(){var e=this;if(this.enabled){var t=(0,w.Sy)(this.collector.data.filter((function(t,o){return!t.drop&&e.collector.stay!==o&&""===t.hasItem}))),o=(0,n.Z)(t,1)[0];if(o){var i=o.index;this.collector.setMushroomIndex(i);var r=this.position[i];r.y=this.property.y-.6;var s=this.serial%v.maxMushroom,a=this.tweeners[s],c=this.bodies[s],l=this.models[s];a&&a.stop().clearQueue().add({from:R(R({},r),{},{y:this.property.y-1}),to:R(R({},r),{},{y:this.property.y}),duration:200,onStart:function(){e.getOffset(),l.visible=!0,c.type=h.Body.STATIC,c.collisionFilterMask=v.collideGroup.unset,c.velocity.setZero()},onUpdate:function(t){c.position.copy({x:t.x+e.offset.x,y:t.y,z:t.z+e.offset.z})},onComplete:function(t){c.position.copy({x:t.x+e.offset.x,y:t.y,z:t.z+e.offset.z}),c.type=h.Body.DYNAMIC,c.velocity.setZero(),c.quaternion.setFromAxisAngle(new h.Vec3(1,0,0),0),c.collisionFilterMask=v.collideGroup.box|v.collideGroup.character}}).play()}}}},{key:"addPhysics",value:function(){var e=this,t=this.webgl,o=t.world,n=t.physicsStaticMaterial,i=new h.Cylinder(.16/.6*1,.16/.6*1,.33333333333333337,16,1);this.bodies=(0,u.Z)(new Array(v.maxMushroom).keys()).map((function(){var t=new h.Body({mass:100,shape:i,type:h.Body.STATIC,material:n,collisionFilterGroup:v.collideGroup.mushroom,collisionFilterMask:v.collideGroup.box|v.collideGroup.character});return t.name=e.name,o.addBody(t),t}))}},{key:"addMushroom",value:function(){var e=this;return new Promise((function(t,o){(0,d.Z)(N).then((function(o){var n=o.model;o.gltf.scene.traverse((function(e){var t=e;t.isMesh&&(t.castShadow=!0)})),n.scale.set(1,1,1),e.models=(0,u.Z)(new Array(v.maxMushroom).keys()).map((function(){var t=n.clone();return e.webgl.scene.add(t),t})),e.addPhysics(),t()})).catch(o)}))}},{key:"visible",value:function(e){this.models.forEach((function(t){t.visible=e}))}},{key:"update",value:function(e){var t=this;if(0!==this.models.length){var o=(0,w.f0)(e,"linear");o>this.serial&&(this.serial=o,this.setPositionByIndex()),(0,u.Z)(new Array(v.maxMushroom).keys()).forEach((function(e){var o=t.models[e],n=t.bodies[e].position,i=t.property.correction;o.position.copy({x:n.x+i.x,y:n.y+i.y,z:n.z+i.z})}))}}}]),e}(),F=function(){function e(t){var o=this,n=t.dom,i=t.onMushroomTrigger,s=t.onModulesLoaded,a=t.onGameTimeUp,l=t.onGameCountDown,u=t.onGameOver;(0,r.Z)(this,e),this.webgl=new c.Z(m),this.webgl.controls.controls.enablePan=!1,n.appendChild(this.webgl.render.domElement),this.onMushroomTrigger=i,this.onModulesLoaded=s,this.onGameTimeUp=a,this.onGameOver=u,this.onGameCountDown=l,this.collector=new j,this.cubes=null,this.character=null,this.mushroom=null,this.bamboo=null,this.controller=null,this.cannonDebugger=this.webgl.addCannonDebuger(),this.loaderData={},this.onGLBLoaded=function(e){o.loaderData[e]=!0,Object.keys(o.loaderData).length>=4&&(s(),o.addController(),o.update())},this.firstDelta=!1,this.addGUI(),this.addMushroom(),this.addBamboo(),this.addCubes(u),this.addCharacter(i,u),window.addEventListener("resize",(function(){var e=o.webgl,t=e.camera,n=e.renderer;t.aspect=window.innerWidth/window.innerHeight,t.updateProjectionMatrix(),n.renderer.setSize(window.innerWidth,window.innerHeight)}),!1)}return(0,s.Z)(e,[{key:"addController",value:function(){var e=this.webgl,t=this.cubes,o=this.character,n=this.mushroom,i=this.bamboo;this.controller=new D({webgl:e,cubes:t,character:o,mushroom:n,bamboo:i})}},{key:"addBamboo",value:function(){this.bamboo=new O({webgl:this.webgl,collector:this.collector,onload:this.onGLBLoaded})}},{key:"addMushroom",value:function(){this.mushroom=new J({webgl:this.webgl,collector:this.collector,onload:this.onGLBLoaded})}},{key:"addCharacter",value:function(e,t){var o=this;this.character=new C({webgl:this.webgl,onMushroomTrigger:e,onGameOver:t,collector:this.collector,stopRender:function(){o.controller.stop(),o.bamboo.stop(),o.mushroom.stop(),o.cubes.stop()},onload:this.onGLBLoaded})}},{key:"addCubes",value:function(e){var t=this;this.cubes=new T({webgl:this.webgl,onGameOver:e,collector:this.collector,onGameCountDown:this.onGameCountDown,stopRender:function(){t.controller.stop(),t.bamboo.stop(),t.mushroom.stop(),t.cubes.stop(),t.character.kickOut()},onload:this.onGLBLoaded})}},{key:"addGUI",value:function(){var e=this,t=new a.XS,o=Object.fromEntries(Object.entries(this.webgl.sky.sky.material.uniforms).filter((function(e){return"up"!==e[0]&&"sunPosition"!==e[0]})).map((function(e){return[e[0],e[1].value]})));o.exposure=this.webgl.renderer.renderer.toneMappingExposure,o.azimuth=this.webgl.sky.options.azimuth,o.inclination=this.webgl.sky.options.inclination;var n=function(){var t=e.webgl.sky.sky.material.uniforms;t.turbidity.value=o.turbidity,t.rayleigh.value=o.rayleigh,t.mieCoefficient.value=o.mieCoefficient,t.mieDirectionalG.value=o.mieDirectionalG,e.webgl.renderer.renderer.toneMappingExposure=o.exposure,e.webgl.sky.options.azimuth=o.azimuth,e.webgl.sky.options.inclination=o.inclination,e.webgl.sky.update()},i=t.addFolder("sky");i.add(o,"turbidity",0,20,.1).onChange(n),i.add(o,"rayleigh",0,4,.001).onChange(n),i.add(o,"mieCoefficient",0,4,.001).onChange(n),i.add(o,"mieDirectionalG",0,4,.001).onChange(n),i.add(o,"azimuth",0,Math.PI/2,.001).onChange(n),i.add(o,"inclination",0,Math.PI/2,.001).onChange(n),i.add(o,"exposure",0,1,.001).onChange(n)}},{key:"update",value:function(){var e=this,t=this.webgl,o=t.enterframe,n=t.stats;o.add((function(t){var o,i,r,s,a,c=t.delta;!1===e.firstDelta&&(e.firstDelta=c);var l=c-e.firstDelta;e.character.move(e.controller),null===(o=e.cannonDebugger)||void 0===o||o.update(),null===(i=e.bamboo)||void 0===i||i.update(l),null===(r=e.mushroom)||void 0===r||r.update(l),null===(s=e.character)||void 0===s||s.update(),null===(a=e.cubes)||void 0===a||a.update(l),n.end()}))}}]),e}(),U=o(1509),Y=o(3032),_=o(5967),X=o(5893),W=(0,i.memo)((function(){var e=(0,i.useContext)(U._y),t=(0,n.Z)(e,2)[1],o=(0,i.useRef)(),r=(0,i.useRef)(),s=(0,i.useState)(0),a=(0,n.Z)(s,2),c=a[0],l=a[1];(0,i.useEffect)((function(){c&&t({type:Y.om.modal,state:{enabled:!0,body:"吃到 ".concat(c," 蘑菇了")}})}),[c]);var u=(0,i.useCallback)((function(){t({type:Y.om.loadingProcess,state:{enabled:!1}})}),[]),h=(0,i.useCallback)((function(){l((function(e){return e+1}))}),[]),d=(0,i.useCallback)((function(){t({type:Y.om.modal,state:{enabled:!0,body:"時間到了",time:1e4}})}),[]),f=(0,i.useCallback)((function(){t({type:Y.om.modal,state:{enabled:!0,body:"出界了",time:1e4}})}),[]),y=(0,i.useCallback)((function(e){t({type:Y.om.modal,state:{enabled:!0,body:"倒數".concat(e,"秒開始")}})}),[]),p=(0,i.useCallback)((function(e){r.current.controller.moveJoystick(e)}),[]),m=(0,i.useCallback)((function(){r.current.controller.stopJoystick()}),[]);return(0,i.useEffect)((function(){return t({type:Y.om.loadingProcess,state:{enabled:!0}}),r.current=new F({dom:o.current,onMushroomTrigger:h,onModulesLoaded:u,onGameTimeUp:d,onGameCountDown:y,onGameOver:f}),function(){var e;return null===(e=r.current.webgl)||void 0===e?void 0:e.enterframe.stop()}}),[]),(0,X.jsxs)("div",{className:"h-full w-full",children:[(0,X.jsx)("div",{ref:o,className:"h-full w-full"}),(0,X.jsx)(_.default,{onJoyStickMove:p,onJoyStickStop:m})]})}))},5967:function(e,t,o){"use strict";o.r(t),o.d(t,{default:function(){return z}});var n=o(4942),i=o(885),r=o(7294),s=o(3377),a=o(3379),c=o.n(a),l=o(7795),u=o.n(l),h=o(569),d=o.n(h),f=o(3565),y=o.n(f),p=o(9216),m=o.n(p),b=o(4589),v=o.n(b),w=o(8209),g=o.n(w),x={};x.styleTagTransform=v(),x.setAttributes=y(),x.insert=d().bind(null,"head"),x.domAPI=u(),x.insertStyleElement=m(),c()(g(),x),g()&&g().locals&&g().locals;var k=o(5893);function O(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function M(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?O(Object(o),!0).forEach((function(t){(0,n.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):O(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}var z=(0,r.memo)((function(e){var t=e.onJoyStickMove,o=e.onJoyStickStop,n=(0,r.useState)({x:.5*window.innerWidth,y:.8*window.innerHeight}),a=(0,i.Z)(n,2),c=a[0],l=a[1],u=(0,r.useState)({x:0,y:0}),h=(0,i.Z)(u,2),d=h[0],f=h[1],y=(0,r.useRef)({enabled:!1,sx:0,sy:0,mx:0,my:0}),p=((0,r.useRef)(),(0,r.useMemo)((function(){return{left:c.x,top:c.y}}),[c])),m=p.left,b=p.top,v=(0,r.useCallback)((function(){return{x:.5*window.innerWidth,y:.8*window.innerHeight}}),[]);(0,r.useEffect)((function(){var e=function(){return l(v())};return window.addEventListener("resize",e),function(){return window.removeEventListener("resize",e)}}),[]);var w=(0,r.useCallback)((function(e){var t,o,n=e.clientX||(null===(t=e.touches)||void 0===t||null===(t=t[0])||void 0===t?void 0:t.clientX),i=e.clientY||(null===(o=e.touches)||void 0===o||null===(o=o[0])||void 0===o?void 0:o.clientY);n&&i&&(l({x:n,y:i}),y.current={enabled:!0,sx:n,sy:i,mx:n,my:i})}),[]),g=(0,r.useCallback)((function(){y.current=M(M({},y.current),{},{enabled:!1}),f({x:0,y:0}),o(),l(v())}),[]),x=(0,r.useCallback)((function(e){var o,n;if(y.current.enabled){var i=e.clientX||(null===(o=e.touches)||void 0===o||null===(o=o[0])||void 0===o?void 0:o.clientX),r=e.clientY||(null===(n=e.touches)||void 0===n||null===(n=n[0])||void 0===n?void 0:n.clientY);if(i&&r){y.current=M(M({},y.current),{},{mx:i,my:r});var a=y.current,c={x:a.sx,y:a.sy},l={x:a.mx,y:a.my},u=(0,s.Cn)(c,l),h=(0,s.wU)(c,l),d=h>97?97:h,p=Math.cos(u)*d,m=Math.sin(u)*d;f({x:p,y:m}),t({angle:u,distance:d})}}}),[]);return(0,k.jsx)("div",{className:"Joystick",onMouseDown:w,onTouchStart:w,onMouseUp:g,onTouchEnd:g,onMouseMove:x,onTouchMove:x,role:"none",children:(0,k.jsx)("div",{className:"panel",style:{left:m,top:b},children:(0,k.jsx)("div",{className:"stick",style:{transform:"translateX(".concat(-d.y,"px) translateY(").concat(-d.x,"px)")}})})})}))},3377:function(e,t,o){"use strict";o.d(t,{Cn:function(){return a},Sy:function(){return u},f0:function(){return l},wU:function(){return c}});var n=o(2982),i=o(3431),r=o.n(i),s=o(46),a=function(e,t){return Math.atan2(e.x-t.x,e.y-t.y)},c=function(e,t){var o=e.x-t.x,n=e.y-t.y;return Math.sqrt(Math.pow(o,2)+Math.pow(n,2))},l=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"inCirc",o=2e4,n="inCirc"===t?s.DO.inCirc:s.DO.linear,i=r()(n[0],n[1],n[2],n[3]),a=Math.floor(i(e/o)*o/1e3);return"inCirc"===t&&e>o?e/1e3:a},u=function(e){for(var t,o=(0,n.Z)(e),i=e.length;0!==i;){t=Math.floor(Math.random()*i),i--;var r=[o[t],o[i]];o[i]=r[0],o[t]=r[1]}return o}},8209:function(e,t,o){var n=o(8081),i=o(3645)(n);i.push([e.id,".Joystick {\n    position: absolute;\n    top: 0px;\n    height: 100%;\n    width: 100%;\n    background-color: transparent\n}\n.Joystick .panel {\n    pointer-events: none;\n    position: absolute;\n    margin-left: -10rem;\n    margin-top: -10rem;\n    height: 20rem;\n    width: 20rem;\n    border-radius: 9999px;\n    --tw-bg-opacity: 1;\n    background-color: rgba(148, 163, 184, 1);\n    background-color: rgba(148, 163, 184, var(--tw-bg-opacity));\n    opacity: 0.4\n}\n.Joystick .panel .stick {\n    position: absolute;\n    left: 50%;\n    top: 50%;\n    margin-left: -4rem;\n    margin-top: -4rem;\n    height: 8rem;\n    width: 8rem;\n    border-radius: 9999px;\n    border-width: 4px;\n    --tw-bg-opacity: 1;\n    background-color: rgba(234, 179, 8, 1);\n    background-color: rgba(234, 179, 8, var(--tw-bg-opacity))\n}\n",""]),e.exports=i}}]);