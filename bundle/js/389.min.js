"use strict";(self.webpackChunk_2023_meiji_mushroom_mountain_store=self.webpackChunk_2023_meiji_mushroom_mountain_store||[]).push([[389],{2389:function(e,t,i){i.r(t),i.d(t,{default:function(){return I}});var n=i(7294),o=i(5671),r=i(3144),a=i(4376),s=i(1214),c=i(4942),h=i(2982),u=i(4570),d=i(3687),l=i(9477),p={camera:{fov:50,far:75,type:i(5444).CameraType.perspective},sky:{enabled:!0,turbidity:3.6,rayleigh:.165,mieCoefficient:0,mieDirectionalG:.768,inclination:.25,azimuth:.25},controls:{distance:{min:13,max:30},polar:{min:-70,max:70},azimuth:{min:-1/0,max:1/0},default:{polar:50,azimuth:35},offsetAzimuth:0,enabled:!0,panEasing:100},light:{ambient:{color:13163508,intensity:1},point:{color:16042184,intensity:.9,distance:100,decay:.5,position:{x:0,y:8,z:0}},shadowMapSize:1024,debug:!0},renderer:{alpha:!1,shadowType:l.ntZ,exposure:1,outputEncoding:l.knz,physicallyCorrectLights:!1},physics:!0,stats:!0},y=i.p+"bundle/model/bamboo.glb";function f(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}var b=function(){function e(t){var i=t.webgl;(0,o.Z)(this,e),this.webgl=i,this.model=null,this.body=null,this.property={index:3,y:1.25,size:2,gap:.1,offset:{x:-2.1,z:-2.1},correction:{x:-.07,y:-.25,z:.115}},this.init(),this.addBamboo(),this.randomPosition=function(){return Math.floor(9*Math.random())}}return(0,r.Z)(e,[{key:"init",value:function(){var e=this.property,t=e.y,i=e.gap,n=e.size,o=e.offset;this.position=(0,h.Z)(new Array(9).keys()).map((function(e){var r=Math.floor(e/3),a=e%3*n+e%3*i+o.x,s=Math.floor(e/3)*n+r*i+o.z;return{x:a,y:t,z:s}}))}},{key:"addPhysics",value:function(){var e=this.webgl,t=e.world,i=e.physicsStaticMaterial,n=new d.Cylinder(.1,.16,.5,16,1);this.body=new d.Body({mass:.1,shape:n,type:d.Body.DYNAMIC,material:i}),t.addBody(this.body)}},{key:"setPositionByIndex",value:function(){var e=this.position[this.property.index];this.body.position.copy(e)}},{key:"addBamboo",value:function(){var e=this;return new Promise((function(t,i){(0,u.Z)(y).then((function(i){var n=i.model;i.gltf.scene.traverse((function(e){e.isMesh&&(e.castShadow=!0)})),n.scale.set(.6,.6,.6),e.webgl.scene.add(n),e.model=n,e.addPhysics(),e.setPositionByIndex(),t()})).catch(i)}))}},{key:"visible",value:function(e){this.model.visible=e}},{key:"update",value:function(){if(this.model){var e=this.body.position,t=this.property.correction,i=function(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?f(Object(i),!0).forEach((function(t){(0,c.Z)(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):f(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}({},e);i.x+=t.x,i.y+=t.y,i.z+=t.z,this.model.position.copy(i),this.model.quaternion.copy(this.body.quaternion)}}}]),e}(),m=i.p+"bundle/model/character.glb";function w(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function v(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?w(Object(i),!0).forEach((function(t){(0,c.Z)(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):w(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}var g=function(){function e(t){var i=this,n=t.webgl;(0,o.Z)(this,e),this.webgl=n,this.model=null,this.mixer=null,this.actions={},this.actionName="idle",this.delta=this.webgl.clock.getDelta()+.007,this.isOut=!1,this.property={size:2,position:{x:0,y:1.6,z:0},correction:{x:0,y:-.6,z:0}},this.addCharacter().then((function(){i.actions[i.actionName].play()})),this.update()}return(0,r.Z)(e,[{key:"down",value:function(){this.doActionByName("down")}},{key:"wave",value:function(){this.isOut||this.doActionByName("wavehand")}},{key:"walk",value:function(){this.isOut||this.doActionByName("run")}},{key:"stop",value:function(){this.model&&!this.isOut&&this.doActionByName("idle")}},{key:"rotate",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=new l._fP;t.setFromAxisAngle(new l.Pa4(0,1,0).normalize(),e),this.model.rotation.setFromQuaternion(t)}},{key:"doActionByName",value:function(e){e!==this.actionName&&(this.actionName&&this.actions[this.actionName].stop(),this.actions[e].play(),this.actionName=e)}},{key:"addPhysics",value:function(){var e=this.webgl,t=e.world,i=e.physicsStaticMaterial,n=new d.Sphere(.6);this.body=new d.Body({mass:10,shape:n,type:d.Body.DYNAMIC,material:i}),this.body.position.copy(this.property.position),t.addBody(this.body)}},{key:"addCharacter",value:function(){var e=this;return new Promise((function(t,i){(0,u.Z)(m).then((function(i){var n=i.model,o=i.gltf;o.scene.traverse((function(e){var t=e;t.isMesh&&(t.castShadow=!0)})),e.mixer=new l.Xcj(o.scene),o.animations.forEach((function(t){var i=t.name,n=e.mixer.clipAction(t);e.actions[i.toLowerCase()]=n})),n.scale.set(.6,.6,.6),e.webgl.scene.add(n),e.model=n,e.addPhysics(),t()})).catch(i)}))}},{key:"visible",value:function(e){this.model.visible=e}},{key:"move",value:function(e){if(!this.isOut&&(this.body||this.model)){var t=e.ArrowLeft,i=void 0===t?0:t,n=e.ArrowRight,o=void 0===n?0:n,r=e.ArrowUp,a=void 0===r?0:r,s=e.ArrowDown,c=i-o,h=a-(void 0===s?0:s),u={"00":!1,10:-Math.PI/2,"-10":Math.PI/2,"01":Math.PI,"0-1":0,"-11":Math.PI/4*3,11:-Math.PI/4*3,"1-1":-Math.PI/4,"-1-1":Math.PI/4}["".concat(c).concat(h)];!1!==u?this.rotate(u):this.stop();var d=v({},this.body.position);d.x-=.05*c,d.z-=.05*h,this.body.velocity.x=0,this.body.velocity.z=0,this.body.position.x=d.x,this.body.position.z=d.z}}},{key:"update",value:function(){if(this.model){var e,t=this.body.position,i=this.property.correction,n=v({},t);if(n.x+=i.x,n.y+=i.y,n.z+=i.z,this.model.position.copy(n),null===(e=this.mixer)||void 0===e||e.update(this.delta),this.isOut)return;t.y<=1.55&&(this.isOut=!0,this.down())}}}]),e}(),k=function(){function e(t){var i=t.character,n=t.bamboo,r=t.mushroom,a=t.cubes;(0,o.Z)(this,e),this.character=i,this.bamboo=n,this.mushroom=r,this.cubes=a,this.direct={},this.speed=1,this.addEvents()}return(0,r.Z)(e,[{key:"addEvents",value:function(){var e=this;window.addEventListener("keydown",(function(t){e.character.walk();var i=t.key;switch(i){case"ArrowLeft":case"ArrowUp":case"ArrowRight":case"ArrowDown":e.direct[i]=1}})),window.addEventListener("keyup",(function(t){var i=t.key;switch(i){case"ArrowLeft":case"ArrowUp":case"ArrowRight":case"ArrowDown":e.direct[i]=0}}))}}]),e}(),O=i(5861),z=i(4687),x=i.n(z),P=function(){var e=(0,O.Z)(x().mark((function e(t){var i;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=new l.dpR,e.abrupt("return",new Promise((function(e,n){i.load(t,(function(t){e(t)}),n)})));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),j=P,M=i.p+"bundle/image/pages/game/webgl/texture/cube-top.jpg",B=i.p+"bundle/image/pages/game/webgl/texture/cube-side.jpg",C=function(){function e(t){var i=this,n=t.webgl;(0,o.Z)(this,e),this.webgl=n,this.numberOfBox=9,this.size=2,this.gapSize=.1,this.data=(0,h.Z)(new Array(this.numberOfBox).keys()).map((function(){return Math.floor(Math.random()*i.numberOfBox)})),this.addBoxes()}var t;return(0,r.Z)(e,[{key:"addPhysics",value:function(e){var t=e.col,i=e.row,n=e.i,o=this.webgl,r=o.world,a=o.physicsStaticMaterial,s=new d.Vec3(1,1,1),c=new d.Box(s),h=new d.Body({mass:0,shape:c,type:d.Body.STATIC,material:a}),u=1*(this.size+this.gapSize),l=1*(this.size+this.gapSize),p=n%3*this.size+i*this.gapSize-u,y=Math.floor(n/3)*this.size+t*this.gapSize-l;h.position.set(p,0,y),r.addBody(h)}},{key:"addBoxes",value:(t=(0,O.Z)(x().mark((function e(){var t,i,n,o,r=this;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j(M);case 2:return t=e.sent,e.next=5,j(B);case 5:i=e.sent,t.wrapS=l.rpg,t.wrapT=l.rpg,t.repeat.set(1,.1),n=this.webgl.scene,o=new l.ZAu,this.boxes=(0,h.Z)(new Array(this.numberOfBox).keys()).map((function(e){var n=new l.DvJ(r.size,r.size,r.size),a=new l.YBo({color:1641989}),s=new l.Wid({map:t.clone()}),c=new l.Wid({map:i});s.map.offset.set(0,.1*r.data[e]);var h=new l.Kj0(n,[c,c,s,a,c,c]),u=Math.floor(e/3),d=e%3,p=e%3*r.size+d*r.gapSize,y=Math.floor(e/3)*r.size+u*r.gapSize;return h.receiveShadow=!0,h.position.set(p,0,y),o.add(h),r.addPhysics({col:u,row:d,i:e}),h})),o.position.x=0-1*(this.size+this.gapSize),o.position.z=0-1*(this.size+this.gapSize),n.add(o);case 15:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"visible",value:function(e){this.boxes.forEach((function(t){t.visible=e}))}}]),e}(),A=i.p+"bundle/model/mushroom.glb";function S(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}var Z=function(){function e(t){var i=t.webgl;(0,o.Z)(this,e),this.webgl=i,this.model=null,this.body=null,this.property={index:5,y:1.25,size:2,gap:.1,offset:{x:-2.1,z:-2.1},correction:{x:-.08,y:-.25,z:.095}},this.init(),this.addMushroom(),this.randomPosition=function(){return Math.floor(9*Math.random())}}return(0,r.Z)(e,[{key:"init",value:function(){var e=this.property,t=e.y,i=e.size,n=e.gap,o=e.offset;this.position=(0,h.Z)(new Array(9).keys()).map((function(e){var r=Math.floor(e/3),a=e%3*i+e%3*n+o.x,s=Math.floor(e/3)*i+r*n+o.z;return{x:a,y:t,z:s}}))}},{key:"setPositionByIndex",value:function(){var e=this.position[this.property.index];this.body.position.copy(e)}},{key:"addPhysics",value:function(){var e=this.webgl,t=e.world,i=e.physicsStaticMaterial,n=new d.Cylinder(.16,.16,.5,16,1);this.body=new d.Body({mass:0,shape:n,type:d.Body.STATIC,material:i}),t.addBody(this.body)}},{key:"addMushroom",value:function(){var e=this;return new Promise((function(t,i){(0,u.Z)(A).then((function(i){var n=i.model;i.gltf.scene.traverse((function(e){var t=e;t.isMesh&&(t.castShadow=!0)})),n.scale.set(.6,.6,.6),e.webgl.scene.add(n),e.model=n,e.addPhysics(),e.setPositionByIndex(),t()})).catch(i)}))}},{key:"visible",value:function(e){this.model.visible=e}},{key:"update",value:function(){if(this.model){var e=this.body.position,t=this.property.correction,i=function(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?S(Object(i),!0).forEach((function(t){(0,c.Z)(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):S(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}({},e);i.x+=t.x,i.y+=t.y,i.z+=t.z,this.model.position.copy(i)}}}]),e}(),D=function(){function e(t){var i=this;(0,o.Z)(this,e),this.webgl=new s.Z(p),this.webgl.controls.controls.enablePan=!1,t.appendChild(this.webgl.render.domElement),this.cubes=null,this.character=null,this.mushroom=null,this.bamboo=null,this.controller=null,this.addGUI(),this.addCubes(),this.addCharacter(),this.addController(),this.update(),window.addEventListener("resize",(function(){var e=i.webgl,t=e.camera,n=e.renderer;t.aspect=window.innerWidth/window.innerHeight,t.updateProjectionMatrix(),n.renderer.setSize(window.innerWidth,window.innerHeight)}),!1)}return(0,r.Z)(e,[{key:"addController",value:function(){var e=this.webgl,t=this.cubes,i=this.character,n=this.mushroom,o=this.bamboo;this.controller=new k({webgl:e,cubes:t,character:i,mushroom:n,bamboo:o})}},{key:"addBamboo",value:function(){this.bamboo=new b({webgl:this.webgl})}},{key:"addMushroom",value:function(){this.mushroom=new Z({webgl:this.webgl})}},{key:"addCharacter",value:function(){this.character=new g({webgl:this.webgl})}},{key:"addCubes",value:function(){this.cubes=new C({webgl:this.webgl})}},{key:"addGUI",value:function(){var e=this,t=new a.XS,i=Object.fromEntries(Object.entries(this.webgl.sky.sky.material.uniforms).filter((function(e){return"up"!==e[0]&&"sunPosition"!==e[0]})).map((function(e){return[e[0],e[1].value]})));i.exposure=this.webgl.renderer.renderer.toneMappingExposure,i.azimuth=this.webgl.sky.options.azimuth,i.inclination=this.webgl.sky.options.inclination;var n=function(){var t=e.webgl.sky.sky.material.uniforms;t.turbidity.value=i.turbidity,t.rayleigh.value=i.rayleigh,t.mieCoefficient.value=i.mieCoefficient,t.mieDirectionalG.value=i.mieDirectionalG,e.webgl.renderer.renderer.toneMappingExposure=i.exposure,e.webgl.sky.options.azimuth=i.azimuth,e.webgl.sky.options.inclination=i.inclination,e.webgl.sky.update()},o=t.addFolder("sky");o.add(i,"turbidity",0,20,.1).onChange(n),o.add(i,"rayleigh",0,4,.001).onChange(n),o.add(i,"mieCoefficient",0,4,.001).onChange(n),o.add(i,"mieDirectionalG",0,4,.001).onChange(n),o.add(i,"azimuth",0,Math.PI/2,.001).onChange(n),o.add(i,"inclination",0,Math.PI/2,.001).onChange(n),o.add(i,"exposure",0,1,.001).onChange(n);var r=t.addFolder("character"),s={"揮手":function(){return e.character.wave()},"跑步":function(){return e.character.walk()},"掉落":function(){return e.character.down()}};r.add(s,"揮手"),r.add(s,"跑步"),r.add(s,"掉落"),t.addFolder("debug").add({mesh:!0},"mesh").onChange((function(t){var i,n,o,r;null===(i=e.cubes)||void 0===i||i.visible(t),null===(n=e.character)||void 0===n||n.visible(t),null===(o=e.bamboo)||void 0===o||o.visible(t),null===(r=e.mushroom)||void 0===r||r.visible(t)}))}},{key:"update",value:function(){var e=this,t=this.webgl,i=t.enterframe,n=t.stats;i.add((function(){var t,i,o,r;e.character.move(e.controller.direct),null===(t=e.cannonDebugger)||void 0===t||t.update(),null===(i=e.bamboo)||void 0===i||i.update(),null===(o=e.mushroom)||void 0===o||o.update(),null===(r=e.character)||void 0===r||r.update(),n.end()}))}}]),e}(),E=i(5893),I=(0,n.memo)((function(){var e=(0,n.useRef)();return(0,n.useEffect)((function(){new D(e.current)}),[]),(0,E.jsx)("div",{ref:e,className:"h-full w-full"})}))}}]);